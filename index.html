<script>
    const chapters = [
        { title: "Chapter I: The Echo", text: "We started as two names on a list, two faces in a crowded room on a 'Welcome Day' that felt ordinary at the time.\n\nI didn’t know then that the girl sitting across the room would eventually become the reason I look forward to the morning." },
        { title: "Chapter II: The Shift", text: "Then the world moved us closer. New titles, new reasons to speak.\n\nWhat started as 'work' became 'us.' I began to notice the way you carried yourself—with a grace that seemed effortless and a kindness that felt like sunlight." },
        { title: "Chapter III: The Thread", text: "The office walls eventually faded, but our conversation didn’t.\n\nWe found a new home in the glow of our screens, weaving a thread of words that stretched from morning until the stars came out." },
        { title: "Chapter IV: The Song", text: "I’ve learned the map of your reactions now. When I tell you that you are too bright for my eyes, or ask how it’s possible for someone to go to such lengths to be beautiful, you make those quiet, cute little noises." },
        { title: "Chapter V: The Warmth", text: "Being near you feels like finally standing in the right place.\n\nIt is a peaceful warmth, but it is also a storm in my chest. When you smile at me, my heart pounds with a rhythm I can’t control." },
        { title: "Chapter VI: The Realization", text: "I wrote this because words spoken out loud sometimes get lost in the heartbeat I feel when you're near. 'Just friends' felt like a beautiful book with the most important chapter missing." },
        { 
            title: "The Final Page: My Queen", 
            isFinal: true,
            text: "Now that we are walking this path together, I’ve fallen for you faster than I ever thought possible. I find myself constantly desiring the warmth of your hugs and the sweetness of your kisses. I will forever treat you well, my Queen." 
        }
    ];

    let currentPage = 0;
    let yesScale = 1;

    function createHeart() {
        const heart = document.createElement('div');
        heart.classList.add('heart');
        heart.innerHTML = '❤️';
        heart.style.left = Math.random() * 100 + 'vw';
        heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 4000);
    }
    setInterval(createHeart, 500);

    // --- REBUILT MOVE LOGIC ---
    function moveButton(event) {
        if(event) event.preventDefault();
        const btn = document.getElementById('noBtn');
        
        // Define safe area (stay 60px away from edges)
        const padding = 60; 
        const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);

        // Calculate available space
        const maxX = vw - btn.offsetWidth - padding;
        const maxY = vh - btn.offsetHeight - padding;

        // Pick a random spot inside the safe area
        const randomX = Math.floor(Math.random() * (maxX - padding)) + padding;
        const randomY = Math.floor(Math.random() * (maxY - padding)) + padding;

        btn.style.position = 'fixed';
        btn.style.left = randomX + 'px';
        btn.style.top = randomY + 'px';
        btn.style.zIndex = "9999"; // Keep it on top

        // Grow the Yes button
        yesScale += 0.12;
        const yesBtn = document.getElementById('yesBtn');
        yesBtn.style.transform = `scale(${yesScale})`;
        
        // Ensure Yes button doesn't hide everything (limit growth on mobile)
        if(vw < 600 && yesScale > 3) {
            yesBtn.style.transform = `scale(3)`; 
        }
    }

    function sayYes() {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        document.getElementById('question').innerText = "I knew you would say YES! ❤️";
        document.getElementById('mainButtons').style.display = 'none';
        document.getElementById('storyBtn').style.display = 'block';
    }

    function openBook() { document.getElementById('bookModal').style.display = 'flex'; updateBookContent(); }
    function closeBook() { document.getElementById('bookModal').style.display = 'none'; }
    function changePage(step) { currentPage += step; updateBookContent(); }

    function updateBookContent() {
        const content = document.getElementById('bookContent');
        const pageInfo = document.getElementById('pageIndicator');
        const ch = chapters[currentPage];
        
        let galleryHtml = "";
        if (ch.isFinal) {
            galleryHtml = `
                <div class="gallery">
                    <img src="photo1.jpg" alt="1" onerror="this.style.display='none'">
                    <img src="photo2.jpg" alt="2" onerror="this.style.display='none'">
                    <img src="photo3.jpg" alt="3" onerror="this.style.display='none'">
                    <img src="photo4.jpg" alt="4" onerror="this.style.display='none'">
                </div>`;
        }

        content.innerHTML = `<h2>${ch.title}</h2><p style="white-space: pre-line;">${ch.text}</p>${galleryHtml}`;
        pageInfo.innerText = `Page ${currentPage + 1} of ${chapters.length}`;
        
        document.getElementById('prevBtn').disabled = (currentPage === 0);
        document.getElementById('nextBtn').disabled = (currentPage === chapters.length - 1);
        content.scrollTop = 0;
    }
</script>
